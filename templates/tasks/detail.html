{% extends 'layouts/app.html' %}
{% block title %}{{ task.title }} - Tekista{% endblock %}
{% block content %}
<div class="max-w-4xl">
  <div class="mb-6">
    <h1 class="text-xl font-semibold text-white">{{ task.title }}</h1>
    {% if task.description %}
      <p class="mt-1 text-sm text-gray-400">{{ task.description }}</p>
    {% endif %}
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <div>
      <div class="text-xs text-gray-400 mb-1">Status</div>
      <span class="text-xs px-2 py-1 rounded border border-white/10 text-gray-300">{{ task.status }}</span>
    </div>
    <div>
      <div class="text-xs text-gray-400 mb-1">Priority</div>
      <span class="text-xs px-2 py-1 rounded border border-white/10 text-gray-300">{{ task.priority }}</span>
    </div>
    <div>
      <div class="text-xs text-gray-400 mb-1">Due</div>
      <div class="text-sm text-gray-300">{{ task.due_date or 'â€”' }}</div>
    </div>
  </div>

  <div class="mb-6">
    <div class="text-xs text-gray-400">Assignees</div>
    <div class="text-sm text-gray-300">{% for u in task.assignees %}{{ u.username }}{% if not loop.last %}, {% endif %}{% endfor %}{% if not task.assignees %}-{% endif %}</div>
  </div>

  <div class="mb-6">
    <div class="text-xs text-gray-400 mb-2">Dependencies</div>
    <div class="rounded border border-white/10 bg-white/5">
      {% if task.predecessors %}
        {% for p in task.predecessors %}
        <div class="px-4 py-2 border-b border-white/5 flex items-center justify-between">
          <div class="text-sm text-white">{{ p.title }}</div>
          <span class="text-xs px-2 py-1 rounded border border-white/10 text-gray-300">{{ p.status }}</span>
        </div>
        {% endfor %}
      {% else %}
        <div class="px-4 py-3 text-sm text-gray-400">None</div>
      {% endif %}
    </div>
  </div>

  <form method="post" class="mb-8">
    {{ form.hidden_tag() }}
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 items-end">
      <div class="sm:col-span-2">
        <label class="block text-sm text-gray-300 mb-1">{{ form.status.label.text }}</label>
        {{ form.status(class='w-full px-3 py-2 rounded bg-white/5 border border-white/10 text-gray-200') }}
      </div>
      <div>
        {{ form.submit(class='w-full px-4 py-2 rounded border border-white/10 bg-accent/20 text-white text-sm hover:bg-accent/30') }}
      </div>
    </div>
  </form>

  <div class="rounded border border-white/10 bg-white/5">
    <div class="px-4 py-2 text-xs uppercase text-gray-400 border-b border-white/10">Comments</div>
    {% if task.comments %}
      <div class="divide-y divide-white/5">
        {% for c in task.comments %}
        <div class="px-4 py-3">
          <div class="flex items-center justify-between text-xs text-gray-400">
            <span>{{ c.author.username if c.author }}</span>
            <span>{{ c.created_at }}</span>
          </div>
          <div class="text-sm text-gray-200 mt-1">{{ c.body }}</div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="px-4 py-6 text-sm text-gray-400">No comments yet</div>
    {% endif %}
  </div>

  <div class="mt-4">
    <h3 class="text-sm font-medium text-white mb-2">Add a comment</h3>
    <form method="post" class="space-y-3">
      {{ comment_form.hidden_tag() }}
      {{ comment_form.body(class='w-full px-3 py-2 rounded bg-white/5 border border-white/10 text-gray-200', rows='3', placeholder='Write a comment...') }}
      {{ comment_form.submit(class='px-4 py-2 rounded border border-white/10 bg-white/5 text-white text-sm hover:bg-white/10') }}
    </form>
  </div>
</div>
{% endblock %}
