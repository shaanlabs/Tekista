{% extends 'base.html' %}
{% block title %}{{ task.title }} - TaskManager{% endblock %}
{% block content %}
<div class="enterprise-card mb-3">
	<div class="card-header-enterprise">
		<h3 class="card-title-enterprise">{{ task.title }}</h3>
	</div>
	<div class="card-body">
		<p class="text-muted">{{ task.description }}</p>
		<div class="row mb-3">
			<div class="col-md-4">
				<span class="badge {% if task.status=='Done' %}badge-status-done{% elif task.status=='In Progress' %}badge-status-in-progress{% else %}badge-status-todo{% endif %}">{{ task.status }}</span>
			</div>
			<div class="col-md-4">
				<span class="priority-indicator {{ task.priority|lower }}">Priority: {{ task.priority }}</span>
			</div>
			<div class="col-md-4">
				<i class="fas fa-calendar-alt me-1"></i> Due: {{ task.due_date or 'â€”' }}
			</div>
		</div>
		<div class="mb-3">
			<strong>Assignees:</strong>
			<span class="ms-2">{% for u in task.assignees %}{{ u.username }}{% if not loop.last %}, {% endif %}{% endfor %}</span>
		</div>
		<div class="mb-3">
			<h5>Dependencies</h5>
			<ul class="dependency-list">
				{% for p in task.predecessors %}
				<li class="dependency-item {{ 'completed' if p.status=='Done' else ('in-progress' if p.status=='In Progress' else 'todo') }}">
					<span class="dependency-status {{ 'completed' if p.status=='Done' else ('in-progress' if p.status=='In Progress' else 'todo') }}"></span>
					<span>{{ p.title }} ({{ p.status }})</span>
				</li>
				{% else %}
				<li class="text-muted">None</li>
				{% endfor %}
			</ul>
		</div>
		<form method="post" class="mb-4">
			{{ form.hidden_tag() }}
			<div class="row g-2 align-items-end">
				<div class="col-md-6">{{ form.status.label(class="form-label") }}{{ form.status(class="form-select") }}</div>
				<div class="col-md-3 d-grid">{{ form.submit(class="btn btn-primary") }}</div>
			</div>
		</form>
		<h5>Comments</h5>
		<ul class="mt-2">
			{% for c in task.comments %}
			<li class="comment-item">
				<div class="comment-header">
					<span class="comment-author">{{ c.author.username if c.author }}</span>
					<span class="comment-time">{{ c.created_at }}</span>
				</div>
				<div class="comment-body">{{ c.body }}</div>
			</li>
			{% else %}
			<li class="text-muted">No comments yet</li>
			{% endfor %}
		</ul>
		<h6 class="mt-3">Add a comment</h6>
		<form method="post">
			{{ comment_form.hidden_tag() }}
			<div class="mb-3">{{ comment_form.body(class="form-control", rows=3, placeholder="Write a comment...") }}</div>
			{{ comment_form.submit(class="btn btn-secondary") }}
		</form>
	</div>
</div>
{% endblock %}
